---------------------------------------------------------
-- Build Tables for Udemy Exercises
---------------------------------------------------------
--Use Shop instead of Store since Store is a reserved word
--in AlaSQL.. :(

create table Customer
(
    CustomerID int not null,
    PhoneNumber varchar(15),
    Email varchar(40),
    LastName varchar(40),
    StreetAddress varchar(40),
    City Varchar(20),
    StateProvidence Varchar(10),
    PostalCode Varchar(15)
);

create table Coupon
(
    CouponID int not null,
    CouponName varchar(20)  unique not null,
    CouponDescription varchar(80),
    PercentDiscount int not null,
    ExpirationDate date not null
);

create table Product
(
    ProductID int not null,
    ProductName varchar(20) not null,
    ProductType varchar(5) not null,
    Price float not null
);


create table CustomerOrder
(
    CustomerOrderID int not null,
    CustomerID int not null,
    OrderTakerID int not null,
    OrderDate date not null,
    CouponID int
);


create table CustomerOrderItem
(
    CustomerOrderItemID int not null,
    CustomerOrderID int not null,
    ProductID int not null,
    Quantity int not null,
    SpecialInstructions varchar(60)
);


create  view CustomerOrderDetail
as
select o.CustomerOrderID, o.OrderDate, c.CustomerID, c.LastName CustomerName,
    p.ProductName, p.Price, i.Quantity, i.Quantity * p.Price PurchaseAmount
from CustomerOrder o
    inner join Customer c on o.CustomerID = c.CustomerID
    inner join CustomerOrderItem i on  o.CustomerOrderID = i.CustomerOrderID
    inner join Product p on i.ProductID = p.ProductID;

create view CustomerOrderSummary
as
select o.CustomerOrderID, o.OrderDate, c.CustomerID, c.LastName, 
   Sum(i.Quantity * p.Price) OrderPrice,
   Sum(i.Quantity * p.Price) * coalesce(cp.PercentDiscount ,0) / 100.0 DiscountAmount,
   Sum(i.Quantity * p.Price) * (1.00 - (coalesce(cp.PercentDiscount ,0) / 100.0)) FinalOrderPrice
from CustomerOrder o
    inner join Customer c on o.CustomerID = c.CustomerID
    inner join CustomerOrderItem i on o.CustomerOrderID = i.CustomerOrderID
    inner join Product p on i.ProductID = p.ProductID
    left  join Coupon cp on o.CouponID = cp.CouponID
group by o.CustomerOrderID, o.OrderDate, c.CustomerID, c.LastName, cp.PercentDiscount;

create view DailySalesSummary
as
select OrderDate, Sum(FinalOrderPrice) DailySales
from CustomerOrderSummary
group by OrderDate;



---------------------------------------------------------
-- Insert Sample Data
---------------------------------------------------------

insert into Customer (CustomerID, PhoneNumber, Email, LastName, StreetAddress, City, StateProvidence, PostalCode) values
(1, '249-124-4223', 'duffy@coolmail.com', 'Duffy', '120 Magnolia', 'Plainwill', 'MI', '49000'),
(2, '249-124-4323', null, 'Miller', null, null, null, null),
(3, null, null, 'Raheem', '121 Elm', 'Plainwill', 'MI', '49000'),
(4, '249-124-7323', null, 'D''Hers', null, null, null, null),
(5, '249-124-4323','Gaviny@jmail.com', 'Galvin', '345 Beech', 'Plainwill', 'MI', '49000'),
(6, null, null, 'Sullivan', null, null, null, null),
(7, '249-424-4323', null, 'Salavaria', '374 Oak', 'Plainwill', 'MI', '49000'),
(8, null, null, 'Bradley', null, null, null, null),
(9, '249-424-4723', 'bbronw@lookout.com', 'Brown', '2945 Maple', 'Plainwill', 'MI', '49000'),
(10, null, null, 'Wood', null, null, null, null),
(11, '249-424-7238', null, 'Dempsey', '325 Box Wood', 'Plainwill', 'MI', '49080'),
(12, null, 'f4324@@lookout.com', 'Benshoof', null, null, null, null),
(13, '249-124-6525', null, 'Eminhizer', '342 Willow', 'Plainwill', 'MI', '49080'),
(14, null, null, 'McArthur', null, null, null, null),
(15, '249-124-5634', 'shoopthecoopw@coolmail.com', 'Shoop', '865 Ironwood', 'Plainwill', 'MI', '49080'),
(16, null, null, 'Laszio', null, null, null, null);


insert into Coupon (CouponID, CouponName, CouponDescription, PercentDiscount, ExpirationDate) values
(1, '15P', '15% off order', 15, '2022-03-31'),
(2, '10P', '10% off order', 10, '2022-03-15'),
(3, '10PS', '10% off order', 10, '2022-05-15');


insert into Product (ProductID, ProductName, ProductType, Price) values
(1 ,'Smelt Pizza','P',10.99),
(2 ,'Pan Pizza','P',14.89),
(3 ,'Large Pizza','P',16.89),
(4 ,'Small Pizza','P',9.89),
(5 ,'Medium Pizza','P',11.99),
(6 ,'Calazone','S',6.5),
(7 ,'2 Liter Coke','B',4.5),
(8 ,'2 Liter Diet Coke','B',4.5),
(9 ,'Extra Cheese','I',1.5),
(10 ,'Extra Pepperoni','I',1.5),
(11 ,'Delivery','S',5.0);


insert into CustomerOrder (CustomerOrderID, CustomerID, OrderTakerID,  OrderDate, CouponID) values
 (1,1,1,'20220301',1),
(2,2,2,'20220301',1),
(3,3,3,'20220301',1),
(4,4,4,'20220301',1),
(5,5,5,'20220301', null),
(6,6,1,'20220301', null),
(7,7,2,'20220301', null),
(8,8,3,'20220301', null),
(9,9,4,'20220301', null),
(10,10,5,'20220310', null),
(11,11,1,'20220310',2),
(12,12,2,'20220310', null),
(13,13,3,'20220310', null),
(14,14,4,'20220310', null),
(15,15,5,'20220310', null),
(16,16,1,'20220310',2),
(17,2,2,'20220310', null),
(18,4,3,'20220310', null),
(19,6,4,'20220310', null),
(20,8,5,'20220301', null),
(21,9,1,'20220301', null),
(22,10,2,'20220301', null),
(23,1,3,'20220303', null),
(24,5,4,'20220303',1),
(25,3,5,'20220313', null),
(26,1,1,'20220313',1),
(27,2,2,'20220313',1),
(28,3,3,'20220313',1),
(29,4,4,'20220313',2),
(30,5,5,'20220313', null),
(31,6,1,'20220313', null),
(32,7,2,'20220303', null),
(33,9,4,'20220303', null),
(34,10,5,'20220303', null),
(35,11,1,'20220303',2),
(36,12,2,'20220313', null),
(37,14,4,'20220303', null),
(38,15,5,'20220313', null),
(39,16,1,'20220313',2),
(40,2,2,'20220303', null),
(41,6,4,'20220303', null),
(42,8,5,'20220303', null),
(43,9,1,'20220313', null),
(44,10,2,'20220313', null),
(45,5,4,'20220313',1),
(46,3,5,'20220303', null),
(47,1,1,'20220304',2),
(48,2,2,'20220304',2),
(49,3,3,'20220304',2),
(50,4,4,'20220304',2),
(51,5,5,'20220304', null),
(52,6,1,'20220304', null),
(53,7,2,'20220314', null),
(54,8,3,'20220314', null),
(55,9,4,'20220304', null),
(56,10,5,'20220314', null),
(57,11,1,'20220314',2),
(58,12,2,'20220314', null),
(59,13,3,'20220314', null),
(60,14,4,'20220304', null),
(61,15,5,'20220304', null),
(62,16,1,'20220304',2),
(63,2,2,'20220304', null),
(64,4,3,'20220314', null),
(65,6,4,'20220314', null),
(66,8,5,'20220314', null),
(67,9,1,'20220314', null),
(68,10,2,'20220314', null),
(69,1,3,'20220305', null),
(70,5,4,'20220305',1),
(71,3,5,'20220305', null),
(72,1,1,'20220305',1),
(73,2,2,'20220315',1),
(74,3,3,'20220315',1),
(75,4,4,'20220315',1),
(76,5,5,'20220315', null),
(77,6,1,'20220315', null),
(78,7,2,'20220305', null),
(79,9,4,'20220305', null),
(80,10,5,'20220315', null),
(81,11,1,'20220315',2),
(82,12,2,'20220315', null),
(83,14,4,'20220315', null),
(84,15,5,'20220315', null),
(85,16,1,'20220305',2),
(86,2,2,'20220305', null),
(87,6,4,'20220305', null),
(88,8,5,'20220305', null),
(89,9,1,'20220305', null),
(90,10,2,'20220315', null),
(91,5,4,'20220305',1),
(92,3,5,'20220305', null);

insert into CustomerOrderItem (CustomerOrderItemID, CustomerOrderID, ProductID, Quantity, SpecialInstructions) values
(1,1,3,1,null),
(2,2,3,1,null),
(3,3,3,1,null),
(4,4,3,2,null),
(5,4,10,1,null),
(6,5,4,1,null),
(7,5,10,1,null),
(8,6,4,1,null),
(9,6,10,1,null),
(10,7,2,1,null),
(11,7,10,1,null),
(12,8,2,1,null),
(13,8,10,2,null),
(14,8,7,1,null),
(15,9,2,2,null),
(16,9,10,1,null),
(17,9,7,1,null),
(18,10,1,1,'Extra Smelt Please!'),
(19,10,10,1,null),
(20,10,7,1,null),
(21,11,5,1,null),
(22,11,10,1,null),
(23,11,7,1,null),
(24,12,5,1,null),
(25,12,10,3,null),
(26,12,7,1,null),
(27,13,3,3,null),
(28,13,10,1,null),
(29,13,7,1,null),
(30,14,3,1,null),
(31,14,10,1,null),
(32,14,7,1,null),
(33,15,3,1,null),
(34,15,10,1,null),
(35,15,7,1,null),
(36,16,3,1,null),
(37,16,10,1,null),
(38,16,7,1,null),
(39,17,4,2,null),
(40,17,10,2,null),
(41,17,7,2,null),
(42,18,4,1,null),
(43,18,10,1,null),
(44,18,7,1,null),
(45,19,2,1,null),
(46,19,10,1,null),
(47,19,7,1,null),
(48,20,2,3,null),
(49,20,10,1,null),
(50,20,7,1,null),
(51,21,2,1,null),
(52,21,10,3,null),
(53,21,7,1,null),
(54,22,1,1,'Add Salt'),
(55,22,10,1,null),
(56,22,7,1,null),
(57,23,5,1,null),
(58,23,10,1,null),
(59,23,7,1,null),
(60,24,5,2,null),
(61,24,10,1,null),
(62,24,7,3,null),
(63,25,3,2,null),
(64,25,10,2,null),
(65,25,7,1,null),
(66,26,3,2,null),
(67,26,10,1,null),
(68,26,7,1,null),
(69,27,3,2,null),
(70,27,10,1,null),
(71,27,8,1,null),
(72,28,3,2,null),
(73,28,10,1,null),
(74,28,8,1,null),
(75,29,4,2,null),
(76,29,10,3,null),
(77,29,8,1,null),
(78,30,4,2,null),
(79,30,11,1,'Dog is nice, he won''t bite.'),
(80,30,10,1,null),
(81,30,10,1,null),
(82,30,9,2,null),
(83,30,8,2,null),
(84,31,2,2,null),
(85,31,11,1,null),
(86,31,10,1,null),
(87,31,8,1,null),
(88,32,2,1,null),
(89,32,11,1,null),
(90,32,10,1,null),
(91,32,8,1,null),
(92,33,2,1,null),
(93,33,11,1,null),
(94,33,10,1,null),
(95,33,8,1,null),
(96,34,1,3,null),
(97,34,11,1,null),
(98,34,10,1,null),
(99,34,8,1,null),
(100,35,5,1,null),
(101,35,11,1,'We are in the upstairs unit.'),
(102,35,10,2,null),
(103,35,8,1,null),
(104,36,5,1,null),
(105,36,11,1,null),
(106,36,10,1,null),
(107,36,8,1,null),
(108,37,3,2,null),
(109,37,11,1,null),
(110,37,10,1,null),
(111,37,8,3,null),
(112,38,3,1,null),
(113,38,11,1,null),
(114,38,10,1,null),
(115,38,8,1,null),
(116,39,3,1,null),
(117,39,11,1,null),
(118,39,10,1,null),
(119,39,8,1,null),
(120,40,3,1,null),
(121,40,11,1,'Knock hard, door bell is broken'),
(122,40,10,1,null),
(123,40,8,1,null),
(124,41,4,2,null),
(125,41,11,1,null),
(126,41,10,1,null),
(127,41,8,1,null),
(128,42,4,1,null),
(129,42,11,1,null),
(130,42,10,1,null),
(131,42,8,1,null),
(132,43,2,2,null),
(133,43,11,1,null),
(134,43,10,3,null),
(135,43,8,1,null),
(136,44,2,2,null),
(137,44,11,1,null),
(138,44,10,1,null),
(139,44,8,1,null),
(140,45,2,1,null),
(141,45,11,1,'It is the drive way by the two pine trees'),
(142,45,10,2,null),
(143,45,8,1,null),
(144,46,1,2,null),
(145,46,11,1,null),
(146,46,10,1,null),
(147,46,8,4,null),
(148,47,5,1,null),
(149,47,11,1,null),
(150,47,10,1,null),
(151,47,8,1,null),
(152,48,5,2,null),
(153,48,11,1,null),
(154,48,10,1,null),
(155,48,8,1,null),
(156,49,3,2,null),
(157,49,11,1,null),
(158,49,10,1,null),
(159,49,8,1,null),
(160,50,3,1,null),
(161,50,11,1,'Drive carefully!'),
(162,50,10,1,null),
(163,50,8,1,null),
(164,51,3,2,null),
(165,51,11,1,null),
(166,51,10,1,null),
(167,51,8,1,null),
(168,52,3,1,null),
(169,52,11,1,null),
(170,52,10,4,null),
(171,52,8,2,null),
(172,53,4,2,null),
(173,53,11,1,null),
(174,53,10,1,null),
(175,53,8,1,null),
(176,54,4,1,null),
(177,54,11,1,null),
(178,54,10,1,null),
(179,54,8,1,null),
(180,55,2,2,null),
(181,55,11,1,null),
(182,55,10,1,null),
(183,55,8,1,null),
(184,56,2,1,null),
(185,56,10,1,null),
(186,56,8,1,null),
(187,57,2,2,null),
(188,57,10,2,null),
(189,57,8,1,null),
(190,58,1,2,null),
(191,58,10,1,null),
(192,59,5,1,null),
(193,59,10,1,null),
(194,60,5,1,null),
(195,60,10,1,null),
(196,61,3,2,null),
(197,61,10,1,null),
(198,62,3,1,null),
(199,62,10,1,null),
(200,63,3,1,null),
(201,63,10,2,null),
(202,64,3,2,null),
(203,64,10,1,null),
(204,65,4,1,null),
(205,65,10,1,null),
(206,66,4,1,null),
(207,66,10,1,null),
(208,67,2,2,null),
(209,67,10,1,null),
(210,68,2,1,null),
(211,68,10,1,null),
(212,69,2,1,null),
(213,69,10,1,null),
(214,70,1,1,null),
(215,70,10,2,null),
(216,70,9,1,null),
(217,71,5,2,null),
(218,71,10,1,null),
(219,71,9,1,null),
(220,72,5,1,null),
(221,72,10,1,null),
(222,72,9,2,null),
(223,73,3,1,null),
(224,73,10,1,null),
(225,73,9,1,null),
(226,74,3,1,null),
(227,74,10,1,null),
(228,74,9,1,null),
(229,75,3,2,null),
(230,75,10,1,null),
(231,75,9,1,null),
(232,76,3,1,null),
(233,76,10,2,null),
(234,76,9,3,null),
(235,77,4,1,null),
(236,77,10,1,null),
(237,77,9,1,null),
(238,78,4,1,null),
(239,78,10,1,null),
(240,78,9,1,null),
(241,79,2,2,null),
(242,79,10,1,null),
(243,79,9,1,null),
(244,80,2,1,null),
(245,80,10,1,null),
(246,80,9,1,null),
(247,81,2,1,null),
(248,81,10,1,null),
(249,81,9,1,null),
(250,82,1,1,null),
(251,82,10,1,null),
(252,82,9,1,null),
(253,83,5,1,null),
(254,83,10,1,null),
(255,83,9,1,null),
(256,84,5,2,null),
(257,84,10,2,null),
(258,84,9,1,null),
(259,85,3,1,null),
(260,85,10,1,null),
(261,85,9,2,null),
(262,86,3,1,null),
(263,86,10,1,null),
(264,86,9,1,null),
(265,87,3,1,null),
(266,87,10,1,null),
(267,87,9,1,null),
(268,88,3,1,null),
(269,88,10,1,null),
(270,88,9,1,null),
(271,89,4,2,null),
(272,89,10,4,null),
(273,89,9,1,null),
(274,90,4,1,null),
(275,90,10,1,null),
(276,90,9,1,null),
(277,91,2,1,null),
(278,91,10,1,null),
(279,91,9,1,null),
(280,92,2,1,null),
(281,92,10,1,null),
(282,92,9,1,null);
